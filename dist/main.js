(()=>{var e={903:(e,t,r)=>{const a=r(867);e.exports=()=>{let e=!0,t=[],r=a(5),n=a(5),l=a(3),o=a(3),i=a(2);const s=e=>{switch(e){case"Carrier":return r;case"Battleship":return n;case"Destroyer":return l;case"Submarine":return o;case"PatrolBoat":return i;default:return"Error!"}};return{onStart:()=>{if(!0!==e)return"Cannot run it twice bud";{let e=100;for(let r=0;e>r;r++)t.push("")}return e=!1,t},placeShip:(e,r,a)=>(s(a),((e,r,a)=>{let n=1;do{t[e]=`${a} ${n}`,e++,n++,r--}while(0<r)})(e,r,a),t),receiveAttack:(e,r,a)=>{let n,l=t[e];if(""!==l){if("npc"===r){console.log(l);let e=l.split(" ");console.log(e[0]);let t=s(e[0]);console.log(t.isSunk()),t.hit(e[1])}else{let e=s(a);e.hit(r),console.log(e.isSunk(),e.getArray())}t[e]=`${l} - hit`,n="hit"}else t[e]="hit",n="miss";return n},allSunk:()=>{let e=[`${r.isSunk()}`,`${n.isSunk()}`,`${l.isSunk()}`,`${o.isSunk()}`,`${i.isSunk()}`];return console.log(r.isSunk()),console.log(n.isSunk()),e},getGameboardSize:()=>t.length,getGameboardArray:()=>t}}},564:(e,t,r)=>{const a=r(903);e.exports=e=>{let t,r=a();t=void 0===e;const n=e=>t=e,l=e=>{let t=Math.floor(Math.random()*(e.getGameboardSize()-0+1)+0);return"hit"===e.getGameboardArray()[t]?"miss":t};return{onRun:()=>{r.onStart()},attack:(r,a,o,i)=>{let s;if(!0===t){let t=r.getGameboard();if(!0===e){let e=l(t);"miss"===e?(e=l(t),s=t.receiveAttack(e,"npc")):s=t.receiveAttack(e,"npc"),console.log(t.getGameboardArray()[e])}else s=t.receiveAttack(a,o,i);r.setTurn(!0),n(!1)}else s="notTurn";return s},getGameboard:()=>r,setTurn:n}}},867:e=>{e.exports=e=>{array=[];const t=e=>array[e]="hit";return{length:e,hit:r=>(0===array.length?((()=>{for(let t=0;e>t;t++)array.push("")})(),t(r)):t(r),array),isSunk:()=>{for(let t=e-1;array.length>=t;t--){if(0==t)return"hit"===array[t];if("hit"!==array[t])return!1}console.log(array)},getArray:()=>array}}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,r),l.exports}(()=>{"use strict";let e,t,a,n,l=!1;function o(e){document.querySelector(".display-text").textContent=e}function i(r,i){const c=document.querySelector(".game"),u=document.createElement("div");u.className="gameboard",u.dataset.gameboard=`${r}`;for(let r=0;i.getGameboard().getGameboardSize()>r;r++){const i=document.createElement("div");i.dataset.cellId=r,i.className="cell",u.append(i);let c=!1;i.addEventListener("click",(r=>{if(!1===c&&!1===l){const d=document.createElement("p");let h=r.path[1];"cell"===r.path[0].className?(h=void 0,d.textContent="X",i.append(d)):r.target.textContent=r.target.getAttribute("data-ship")[0],o("miss"===(p=s(u.getAttribute("data-gameboard"),r.path[0],h))?"You missed!":"hit"===p?"It's a hit!":"It's not your turn yet!"),c=!0,a=e.getGameboard().allSunk(),n=t.getGameboard().allSunk(),console.log(a,n),o("Waiting for NPC's move."),l=!0,t.attack(e),o("Player, awaiting orders!"),l=!1,setTimeout((()=>{}),500)}else o(!0===l?"Please wait until NPC's order!":"You can't hit the same cell twice!");var p}))}c.append(u)}function s(r,a,n){let l,o,i;if(void 0===n?l=a.getAttribute("data-cell-id"):(i=a.getAttribute("data-ship"),l=n.getAttribute("data-cell-id"),o=a.getAttribute("data-ship-cell")),"npc"===r)return e.attack(t,l,o,i)}function c(e,t,r,a){const n=document.querySelector(`[data-gameboard="${e}"]`);let l=0;for(let i=0;100>i;i++){let s=r+a;if(1==((o=i)-r)*(o-(s-1))<=0){let r=n.children;for(let a=0;r.length>a;a++){let n=r[a].getAttribute("data-cell-id");if(n!=i){if(n>i)break}else{const n=document.createElement("p");"npc"===e||(n.textContent=`${t[0]}`),n.dataset.ship=t,n.dataset.shipCell=l,r[a].append(n),l+=1}}}if(100===i||i>s)break}var o}const u=r(564);let p,d,h,g;function m(e){return"player"===e?p:d}p=u(),d=u(!0),p.onRun(),d.onRun(),h=p.getGameboard(),g=d.getGameboard(),e=m("player"),t=m("npc"),i("player",p),i("npc",d),g.placeShip(1,5,"Carrier"),c("npc","Carrier",1,5),g.placeShip(10,5,"Battleship"),c("npc","Battleship",10,5),g.placeShip(16,3,"Destroyer"),c("npc","Destroyer",16,3),g.placeShip(27,3,"Submarine"),c("npc","Submarine",26,3),g.placeShip(50,2,"PatrolBoat"),c("npc","PatrolBoat",50,2),h.placeShip(3,5,"Carrier"),c("player","Carrier",3,5),h.placeShip(15,5,"Battleship"),c("player","Battleship",14,5),h.placeShip(26,3,"Destroyer"),c("player","Destroyer",25,3),h.placeShip(50,3,"Submarine"),c("player","Submarine",50,3),h.placeShip(70,2,"PatrolBoat"),c("player","PatrolBoat",70,2),o("Player, awaiting orders!")})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixTQUFVLGFBQWMsR0FBSSxHQUNqRHJELEVBQWdCeEIsVUFBVSxHQUFJLEVBQUcsYUFDakM2RSxFQUFxQixTQUFVLFlBQWEsR0FBSSxHQUNoRHJELEVBQWdCeEIsVUFBVSxHQUFJLEVBQUcsYUFDakM2RSxFQUFxQixTQUFVLFlBQWEsR0FBSSxHQUNoRHJELEVBQWdCeEIsVUFBVSxHQUFJLEVBQUcsY0FDakM2RSxFQUFxQixTQUFVLGFBQWMsR0FBSSxHQWxEakQzQixFQUFrQiwyQiIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY2xhc3Nlcy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jbGFzc2VzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NsYXNzZXMvc2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZG9tLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzaGlwID0gcmVxdWlyZShcIi4vc2hpcC5qc1wiKTtcclxuXHJcbmNvbnN0IEdhbWVib2FyZCA9ICgpID0+IHtcclxuICBsZXQgZmlyc3RSdW4gPSB0cnVlO1xyXG4gIGxldCBnYW1lYm9hcmRBcnJheSA9IFtdO1xyXG5cclxuICBsZXQgY2FycmllciA9IHNoaXAoNSk7XHJcbiAgbGV0IGJhdHRsZXNoaXAgPSBzaGlwKDUpO1xyXG4gIGxldCBkZXN0cm95ZXIgPSBzaGlwKDMpO1xyXG4gIGxldCBzdWJtYXJpbmUgPSBzaGlwKDMpO1xyXG4gIGxldCBwYXRyb2xCb2F0ID0gc2hpcCgyKTtcclxuXHJcbiAgY29uc3Qgb25TdGFydCA9ICgpID0+IHtcclxuICAgIGlmIChmaXJzdFJ1biA9PT0gdHJ1ZSkge1xyXG4gICAgICBsZXQgY2VsbHMgPSAxMDA7XHJcblxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgY2VsbHMgPiBpOyBpKyspIHtcclxuICAgICAgICBnYW1lYm9hcmRBcnJheS5wdXNoKFwiXCIpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gXCJDYW5ub3QgcnVuIGl0IHR3aWNlIGJ1ZFwiO1xyXG4gICAgfVxyXG4gICAgZmlyc3RSdW4gPSBmYWxzZTtcclxuICAgIHJldHVybiBnYW1lYm9hcmRBcnJheTtcclxuICB9O1xyXG5cclxuICBjb25zdCBwbGFjZVNoaXAgPSAoY2VsbCwgbGVuZ3RoLCBzaGlwTmFtZSkgPT4ge1xyXG4gICAgZ2V0U2hpcChzaGlwTmFtZSk7XHJcbiAgICBfYWRkU2hpcFRvQXJyYXkoY2VsbCwgbGVuZ3RoLCBzaGlwTmFtZSk7XHJcbiAgICByZXR1cm4gZ2FtZWJvYXJkQXJyYXk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZ2V0U2hpcCA9IChzaGlwTmFtZSkgPT4ge1xyXG4gICAgc3dpdGNoIChzaGlwTmFtZSkge1xyXG4gICAgICBjYXNlIFwiQ2FycmllclwiOlxyXG4gICAgICAgIHJldHVybiBjYXJyaWVyO1xyXG4gICAgICBjYXNlIFwiQmF0dGxlc2hpcFwiOlxyXG4gICAgICAgIHJldHVybiBiYXR0bGVzaGlwO1xyXG4gICAgICBjYXNlIFwiRGVzdHJveWVyXCI6XHJcbiAgICAgICAgcmV0dXJuIGRlc3Ryb3llcjtcclxuICAgICAgY2FzZSBcIlN1Ym1hcmluZVwiOlxyXG4gICAgICAgIHJldHVybiBzdWJtYXJpbmU7XHJcbiAgICAgIGNhc2UgXCJQYXRyb2xCb2F0XCI6XHJcbiAgICAgICAgcmV0dXJuIHBhdHJvbEJvYXQ7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIFwiRXJyb3IhXCI7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlLCBzaGlwQ29vcmRpbmF0ZSwgc2hpcE5hbWUpID0+IHtcclxuICAgIC8vIHNoaXBDb29yZGluYXRlIHNob3VsZCBiZSBpbnNpZGUgdGhlIGRpdiBmb3IgdGhlIHNoaXAgZWxlbWVudFxyXG4gICAgLy8gZmlyc3QgYm94IG9mIHRoZSBzaGlwID0gMCwgc2Vjb25kIGJveCA9IDEsIGV0YywgZXRjLCB0aGlzIHdpbGwgYmUgZGVmaWVuZCB3aXRoIGRhdGEtc2hpcC1pZFxyXG4gICAgbGV0IGluQXJyYXkgPSBnYW1lYm9hcmRBcnJheVtjb29yZGluYXRlXTtcclxuXHJcbiAgICBsZXQgcmVzdWx0O1xyXG5cclxuICAgIGlmIChpbkFycmF5ICE9PSBcIlwiKSB7XHJcbiAgICAgIGlmIChzaGlwQ29vcmRpbmF0ZSA9PT0gXCJucGNcIikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGluQXJyYXkpO1xyXG4gICAgICAgIGxldCBzaGlwcyA9IGluQXJyYXkuc3BsaXQoXCIgXCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNoaXBzWzBdKTtcclxuICAgICAgICBsZXQgc2hpcE9iamVjdCA9IGdldFNoaXAoc2hpcHNbMF0pO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhzaGlwT2JqZWN0LmlzU3VuaygpKTtcclxuXHJcbiAgICAgICAgc2hpcE9iamVjdC5oaXQoc2hpcHNbMV0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBzaGlwT2JqZWN0ID0gZ2V0U2hpcChzaGlwTmFtZSk7XHJcbiAgICAgICAgc2hpcE9iamVjdC5oaXQoc2hpcENvb3JkaW5hdGUpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNoaXBPYmplY3QuaXNTdW5rKCksIHNoaXBPYmplY3QuZ2V0QXJyYXkoKSk7XHJcbiAgICAgIH1cclxuICAgICAgZ2FtZWJvYXJkQXJyYXlbY29vcmRpbmF0ZV0gPSBgJHtpbkFycmF5fSAtIGhpdGA7XHJcbiAgICAgIHJlc3VsdCA9IFwiaGl0XCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBnYW1lYm9hcmRBcnJheVtjb29yZGluYXRlXSA9IFwiaGl0XCI7XHJcbiAgICAgIHJlc3VsdCA9IFwibWlzc1wiO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgX2FkZFNoaXBUb0FycmF5ID0gKGNlbGwsIGxlbmd0aCwgc2hpcE5hbWUpID0+IHtcclxuICAgIGxldCBpID0gMTtcclxuICAgIGRvIHtcclxuICAgICAgZ2FtZWJvYXJkQXJyYXlbY2VsbF0gPSBgJHtzaGlwTmFtZX0gJHtpfWA7XHJcblxyXG4gICAgICBjZWxsKys7XHJcbiAgICAgIGkrKztcclxuICAgICAgbGVuZ3RoLS07XHJcbiAgICB9IHdoaWxlICgwIDwgbGVuZ3RoKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBhbGxTdW5rID0gKCkgPT4ge1xyXG4gICAgbGV0IGFycmF5ID0gW1xyXG4gICAgICBgJHtjYXJyaWVyLmlzU3VuaygpfWAsXHJcbiAgICAgIGAke2JhdHRsZXNoaXAuaXNTdW5rKCl9YCxcclxuICAgICAgYCR7ZGVzdHJveWVyLmlzU3VuaygpfWAsXHJcbiAgICAgIGAke3N1Ym1hcmluZS5pc1N1bmsoKX1gLFxyXG4gICAgICBgJHtwYXRyb2xCb2F0LmlzU3VuaygpfWAsXHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGNhcnJpZXIuaXNTdW5rKCkpO1xyXG4gICAgY29uc29sZS5sb2coYmF0dGxlc2hpcC5pc1N1bmsoKSk7XHJcblxyXG4gICAgbGV0IHRydWVBcnJheSA9IFtcInRydWVcIiwgXCJ0cnVlXCIsIFwidHJ1ZVwiLCBcInRydWVcIiwgXCJ0cnVlXCJdO1xyXG5cclxuICAgIGxldCByZXN1bHQgPSBhcnJheTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGFycmF5RXF1YWxzID0gKGEsIGIpID0+IHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIEFycmF5LmlzQXJyYXkoYSkgJiZcclxuICAgICAgQXJyYXkuaXNBcnJheShiKSAmJlxyXG4gICAgICBhLmxlbmd0aCA9PT0gYi5sZW5ndGggJiZcclxuICAgICAgYS5ldmVyeSgodmFsLCBpbmRleCkgPT4gdmFsID09PSBiW2luZGV4XSlcclxuICAgICk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZ2V0R2FtZWJvYXJkU2l6ZSA9ICgpID0+IHtcclxuICAgIHJldHVybiBnYW1lYm9hcmRBcnJheS5sZW5ndGg7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZ2V0R2FtZWJvYXJkQXJyYXkgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gZ2FtZWJvYXJkQXJyYXk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG9uU3RhcnQsXHJcbiAgICBwbGFjZVNoaXAsXHJcbiAgICByZWNlaXZlQXR0YWNrLFxyXG4gICAgYWxsU3VuayxcclxuICAgIGdldEdhbWVib2FyZFNpemUsXHJcbiAgICBnZXRHYW1lYm9hcmRBcnJheSxcclxuICB9O1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lYm9hcmQ7XHJcbiIsImNvbnN0IGdhbWVib2FyZCA9IHJlcXVpcmUoXCIuL2dhbWVib2FyZFwiKTtcclxuXHJcbmNvbnN0IHBsYXllciA9IChucGMgPSB1bmRlZmluZWQpID0+IHtcclxuICBsZXQgdHVybjtcclxuICBsZXQgcGxheWVyR2FtZWJvYXJkID0gZ2FtZWJvYXJkKCk7XHJcblxyXG4gIGlmIChucGMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgdHVybiA9IHRydWU7XHJcbiAgfSBlbHNlIHtcclxuICAgIHR1cm4gPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGNvbnN0IG9uUnVuID0gKCkgPT4ge1xyXG4gICAgcGxheWVyR2FtZWJvYXJkLm9uU3RhcnQoKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBnZXRHYW1lYm9hcmQgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gcGxheWVyR2FtZWJvYXJkO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNldFR1cm4gPSAoYm9vbGVhbikgPT4ge1xyXG4gICAgcmV0dXJuICh0dXJuID0gYm9vbGVhbik7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgYXR0YWNrID0gKG5wY09iamVjdCwgY29vcmRpbmF0ZSwgc2hpcENvb3JkaW5hdGUsIHNoaXBOYW1lKSA9PiB7XHJcbiAgICBsZXQgcmVzdWx0O1xyXG5cclxuICAgIGlmICh0dXJuID09PSB0cnVlKSB7XHJcbiAgICAgIGxldCBvcHBvbmVudEdhbWVib2FyZCA9IG5wY09iamVjdC5nZXRHYW1lYm9hcmQoKTtcclxuXHJcbiAgICAgIGlmIChucGMgPT09IHRydWUpIHtcclxuICAgICAgICBsZXQgcmFuZG9tQ29vcmRpbmF0ZSA9IGdldFJhbmRvbUNvb3JkaW5hdGUob3Bwb25lbnRHYW1lYm9hcmQpO1xyXG5cclxuICAgICAgICBpZiAocmFuZG9tQ29vcmRpbmF0ZSA9PT0gXCJtaXNzXCIpIHtcclxuICAgICAgICAgIHJhbmRvbUNvb3JkaW5hdGUgPSBnZXRSYW5kb21Db29yZGluYXRlKG9wcG9uZW50R2FtZWJvYXJkKTtcclxuICAgICAgICAgIHJlc3VsdCA9IG9wcG9uZW50R2FtZWJvYXJkLnJlY2VpdmVBdHRhY2socmFuZG9tQ29vcmRpbmF0ZSwgXCJucGNcIik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdCA9IG9wcG9uZW50R2FtZWJvYXJkLnJlY2VpdmVBdHRhY2socmFuZG9tQ29vcmRpbmF0ZSwgXCJucGNcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhvcHBvbmVudEdhbWVib2FyZC5nZXRHYW1lYm9hcmRBcnJheSgpW3JhbmRvbUNvb3JkaW5hdGVdKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXN1bHQgPSBvcHBvbmVudEdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKFxyXG4gICAgICAgICAgY29vcmRpbmF0ZSxcclxuICAgICAgICAgIHNoaXBDb29yZGluYXRlLFxyXG4gICAgICAgICAgc2hpcE5hbWVcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBucGNPYmplY3Quc2V0VHVybih0cnVlKTtcclxuICAgICAgc2V0VHVybihmYWxzZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXN1bHQgPSBcIm5vdFR1cm5cIjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGdldFJhbmRvbUNvb3JkaW5hdGUgPSAob3Bwb25lbnRHYW1lYm9hcmQpID0+IHtcclxuICAgIGxldCByYW5kb21Db29yZGluYXRlID0gTWF0aC5mbG9vcihcclxuICAgICAgTWF0aC5yYW5kb20oKSAqIChvcHBvbmVudEdhbWVib2FyZC5nZXRHYW1lYm9hcmRTaXplKCkgLSAwICsgMSkgKyAwXHJcbiAgICApO1xyXG5cclxuICAgIGxldCBnYW1lYm9hcmQgPSBvcHBvbmVudEdhbWVib2FyZC5nZXRHYW1lYm9hcmRBcnJheSgpO1xyXG5cclxuICAgIGlmIChnYW1lYm9hcmRbcmFuZG9tQ29vcmRpbmF0ZV0gPT09IFwiaGl0XCIpIHtcclxuICAgICAgcmV0dXJuIFwibWlzc1wiO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByYW5kb21Db29yZGluYXRlO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBvblJ1bixcclxuICAgIGF0dGFjayxcclxuICAgIGdldEdhbWVib2FyZCxcclxuICAgIHNldFR1cm4sXHJcbiAgfTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcGxheWVyO1xyXG4iLCJjb25zdCBzaGlwID0gKGxlbmd0aCkgPT4ge1xyXG4gIGFycmF5ID0gW107XHJcblxyXG4gIGNvbnN0IGhpdCA9IChuKSA9PiB7XHJcbiAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGNyZWF0ZUFycmF5KCk7XHJcbiAgICAgIHJlYWxIaXQobik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZWFsSGl0KG4pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGdldEFycmF5ID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJlYWxIaXQgPSAobikgPT4ge1xyXG4gICAgcmV0dXJuIChhcnJheVtuXSA9IFwiaGl0XCIpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNyZWF0ZUFycmF5ID0gKCkgPT4ge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGxlbmd0aCA+IGk7IGkrKykge1xyXG4gICAgICBhcnJheS5wdXNoKFwiXCIpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcclxuICAgIGZvciAobGV0IGkgPSBsZW5ndGggLSAxOyBhcnJheS5sZW5ndGggPj0gaTsgaS0tKSB7XHJcbiAgICAgIGlmIChpID09IDApIHtcclxuICAgICAgICBpZiAoYXJyYXlbaV0gPT09IFwiaGl0XCIpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFycmF5W2ldID09PSBcImhpdFwiKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYXJyYXkpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBsZW5ndGgsXHJcbiAgICBoaXQsXHJcbiAgICBpc1N1bmssXHJcbiAgICBnZXRBcnJheSxcclxuICB9O1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBzaGlwO1xyXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgZ2V0UGxheWVyIH0gZnJvbSBcIi4vZ2FtZVwiO1xyXG5cclxubGV0IHBsYXllck9iamVjdDtcclxubGV0IG5wY09iamVjdDtcclxuXHJcbmxldCBwbGF5ZXJUaW1lb3V0ID0gZmFsc2U7XHJcbmxldCB3aW5uZXIgPSBmYWxzZTtcclxuXHJcbmxldCBwbGF5ZXJTaW5rO1xyXG5sZXQgbnBjU2luaztcclxuXHJcbmZ1bmN0aW9uIGRvbUluaXRpYWxpemUoKSB7XHJcbiAgcGxheWVyT2JqZWN0ID0gZ2V0UGxheWVyKFwicGxheWVyXCIpO1xyXG4gIG5wY09iamVjdCA9IGdldFBsYXllcihcIm5wY1wiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlRGlzcGxheVRleHQoc3RyaW5nKSB7XHJcbiAgY29uc3QgZGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlzcGxheS10ZXh0XCIpO1xyXG5cclxuICBkaXNwbGF5LnRleHRDb250ZW50ID0gc3RyaW5nO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVHYW1lYm9hcmQocGxheWVyTmFtZSwgb2JqZWN0KSB7XHJcbiAgY29uc3QgbWFpbkNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FtZVwiKTtcclxuXHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJnYW1lYm9hcmRcIjtcclxuICBjb250YWluZXIuZGF0YXNldC5nYW1lYm9hcmQgPSBgJHtwbGF5ZXJOYW1lfWA7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBvYmplY3QuZ2V0R2FtZWJvYXJkKCkuZ2V0R2FtZWJvYXJkU2l6ZSgpID4gaTsgaSsrKSB7XHJcbiAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIGNlbGwuZGF0YXNldC5jZWxsSWQgPSBpO1xyXG4gICAgY2VsbC5jbGFzc05hbWUgPSBcImNlbGxcIjtcclxuICAgIGNvbnRhaW5lci5hcHBlbmQoY2VsbCk7XHJcblxyXG4gICAgbGV0IGhpdCA9IGZhbHNlO1xyXG5cclxuICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICAgIGlmIChoaXQgPT09IGZhbHNlICYmIHBsYXllclRpbWVvdXQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xyXG5cclxuICAgICAgICBsZXQgZTIgPSBlLnBhdGhbMV07XHJcblxyXG4gICAgICAgIGlmIChlLnBhdGhbMF0uY2xhc3NOYW1lID09PSBcImNlbGxcIikge1xyXG4gICAgICAgICAgZTIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gXCJYXCI7XHJcbiAgICAgICAgICBjZWxsLmFwcGVuZCh0ZXh0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZS50YXJnZXQudGV4dENvbnRlbnQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNoaXBcIilbMF07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbWVzc2FnZSA9IGRvbUF0dGFjayhcclxuICAgICAgICAgIGNvbnRhaW5lci5nZXRBdHRyaWJ1dGUoXCJkYXRhLWdhbWVib2FyZFwiKSxcclxuICAgICAgICAgIGUucGF0aFswXSxcclxuICAgICAgICAgIGUyXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgYXR0YWNrTWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICBoaXQgPSB0cnVlO1xyXG5cclxuICAgICAgICBwbGF5ZXJTaW5rID0gcGxheWVyT2JqZWN0LmdldEdhbWVib2FyZCgpLmFsbFN1bmsoKTtcclxuICAgICAgICBucGNTaW5rID0gbnBjT2JqZWN0LmdldEdhbWVib2FyZCgpLmFsbFN1bmsoKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2cocGxheWVyU2luaywgbnBjU2luayk7XHJcblxyXG4gICAgICAgIGNoYW5nZURpc3BsYXlUZXh0KFwiV2FpdGluZyBmb3IgTlBDJ3MgbW92ZS5cIik7XHJcbiAgICAgICAgcGxheWVyVGltZW91dCA9IHRydWU7XHJcblxyXG4gICAgICAgIG5wY09iamVjdC5hdHRhY2socGxheWVyT2JqZWN0KTtcclxuICAgICAgICBjaGFuZ2VEaXNwbGF5VGV4dChcIlBsYXllciwgYXdhaXRpbmcgb3JkZXJzIVwiKTtcclxuICAgICAgICBwbGF5ZXJUaW1lb3V0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge30sIDUwMCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGxheWVyVGltZW91dCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNoYW5nZURpc3BsYXlUZXh0KFwiUGxlYXNlIHdhaXQgdW50aWwgTlBDJ3Mgb3JkZXIhXCIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNoYW5nZURpc3BsYXlUZXh0KFwiWW91IGNhbid0IGhpdCB0aGUgc2FtZSBjZWxsIHR3aWNlIVwiKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBtYWluQ29udGFpbmVyLmFwcGVuZChjb250YWluZXIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhdHRhY2tNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICBpZiAobWVzc2FnZSA9PT0gXCJtaXNzXCIpIHtcclxuICAgIGNoYW5nZURpc3BsYXlUZXh0KFwiWW91IG1pc3NlZCFcIik7XHJcbiAgfSBlbHNlIGlmIChtZXNzYWdlID09PSBcImhpdFwiKSB7XHJcbiAgICBjaGFuZ2VEaXNwbGF5VGV4dChcIkl0J3MgYSBoaXQhXCIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjaGFuZ2VEaXNwbGF5VGV4dChcIkl0J3Mgbm90IHlvdXIgdHVybiB5ZXQhXCIpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZG9tQXR0YWNrKHBsYXllciwgZTEsIGUyKSB7XHJcbiAgbGV0IGNvb3JkaW5hdGU7XHJcbiAgbGV0IHNoaXBDb29yZGluYXRlO1xyXG4gIGxldCBzaGlwTmFtZTtcclxuXHJcbiAgaWYgKGUyID09PSB1bmRlZmluZWQpIHtcclxuICAgIGNvb3JkaW5hdGUgPSBlMS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNlbGwtaWRcIik7XHJcbiAgfSBlbHNlIHtcclxuICAgIHNoaXBOYW1lID0gZTEuZ2V0QXR0cmlidXRlKFwiZGF0YS1zaGlwXCIpO1xyXG4gICAgY29vcmRpbmF0ZSA9IGUyLmdldEF0dHJpYnV0ZShcImRhdGEtY2VsbC1pZFwiKTtcclxuICAgIHNoaXBDb29yZGluYXRlID0gZTEuZ2V0QXR0cmlidXRlKFwiZGF0YS1zaGlwLWNlbGxcIik7XHJcbiAgfVxyXG5cclxuICBpZiAocGxheWVyID09PSBcIm5wY1wiKSB7XHJcbiAgICByZXR1cm4gcGxheWVyT2JqZWN0LmF0dGFjayhucGNPYmplY3QsIGNvb3JkaW5hdGUsIHNoaXBDb29yZGluYXRlLCBzaGlwTmFtZSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBwbGFjZVNoaXBPbkdhbWVib2FyZChwbGF5ZXJOYW1lLCBzaGlwTmFtZSwgc3RhcnRQb2ludCwgbGVuZ3RoKSB7XHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtZ2FtZWJvYXJkPVwiJHtwbGF5ZXJOYW1lfVwiXWApO1xyXG4gIGxldCBydW4gPSAwO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgMTAwID4gaTsgaSsrKSB7XHJcbiAgICBsZXQgbiA9IHN0YXJ0UG9pbnQgKyBsZW5ndGg7XHJcbiAgICBpZiAoaW5SYW5nZShpLCBzdGFydFBvaW50LCBuIC0gMSkgPT09IHRydWUpIHtcclxuICAgICAgbGV0IGNoaWxkcmVuID0gY29udGFpbmVyLmNoaWxkcmVuO1xyXG5cclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGNoaWxkcmVuLmxlbmd0aCA+IGo7IGorKykge1xyXG4gICAgICAgIGxldCBjZWxsSWQgPSBjaGlsZHJlbltqXS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNlbGwtaWRcIik7XHJcblxyXG4gICAgICAgIGlmIChjZWxsSWQgPT0gaSkge1xyXG4gICAgICAgICAgY29uc3Qgc2hpcFNvbWV0aGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xyXG5cclxuICAgICAgICAgIGlmIChwbGF5ZXJOYW1lID09PSBcIm5wY1wiKSB7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaGlwU29tZXRoaW5nLnRleHRDb250ZW50ID0gYCR7c2hpcE5hbWVbMF19YDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBzaGlwU29tZXRoaW5nLmRhdGFzZXQuc2hpcCA9IHNoaXBOYW1lO1xyXG4gICAgICAgICAgc2hpcFNvbWV0aGluZy5kYXRhc2V0LnNoaXBDZWxsID0gcnVuO1xyXG5cclxuICAgICAgICAgIGNoaWxkcmVuW2pdLmFwcGVuZChzaGlwU29tZXRoaW5nKTtcclxuXHJcbiAgICAgICAgICBydW4gKz0gMTtcclxuXHJcbiAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNlbGxJZCA+IGkpIHtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGkgPT09IDEwMCB8fCBpID4gbikge1xyXG4gICAgICBicmVhaztcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGluUmFuZ2UoeCwgbWluLCBtYXgpIHtcclxuICByZXR1cm4gKHggLSBtaW4pICogKHggLSBtYXgpIDw9IDA7XHJcbn1cclxuXHJcbmV4cG9ydCB7XHJcbiAgY2hhbmdlRGlzcGxheVRleHQsXHJcbiAgY3JlYXRlR2FtZWJvYXJkLFxyXG4gIHBsYWNlU2hpcE9uR2FtZWJvYXJkLFxyXG4gIGRvbUluaXRpYWxpemUsXHJcbn07XHJcbiIsImltcG9ydCB7XHJcbiAgY2hhbmdlRGlzcGxheVRleHQsXHJcbiAgY3JlYXRlR2FtZWJvYXJkLFxyXG4gIGRvbUluaXRpYWxpemUsXHJcbiAgcGxhY2VTaGlwT25HYW1lYm9hcmQsXHJcbn0gZnJvbSBcIi4vZG9tXCI7XHJcblxyXG5jb25zdCBwbGF5ZXJGYWN0b3J5ID0gcmVxdWlyZShcIi4vY2xhc3Nlcy9wbGF5ZXJcIik7XHJcblxyXG5sZXQgcGxheWVyO1xyXG5sZXQgbnBjO1xyXG5cclxubGV0IHBsYXllckdhbWVib2FyZDtcclxubGV0IG5wY0dhbWVib2FyZDtcclxuXHJcbmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgY3JlYXRlUGxheWVycygpO1xyXG4gIGdldEdhbWVib2FyZHMoKTtcclxuICBkb21Jbml0aWFsaXplKCk7XHJcbiAgY3JlYXRlR2FtZWJvYXJkcygpO1xyXG4gIHBsYWNlU2hpcHMoKTtcclxuICBjaGFuZ2VEaXNwbGF5VGV4dChcIlBsYXllciwgYXdhaXRpbmcgb3JkZXJzIVwiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0UGxheWVyKHBsYXllck5hbWUpIHtcclxuICBpZiAocGxheWVyTmFtZSA9PT0gXCJwbGF5ZXJcIikge1xyXG4gICAgcmV0dXJuIHBsYXllcjtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIG5wYztcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEdhbWVib2FyZHMoKSB7XHJcbiAgcGxheWVyR2FtZWJvYXJkID0gcGxheWVyLmdldEdhbWVib2FyZCgpO1xyXG4gIG5wY0dhbWVib2FyZCA9IG5wYy5nZXRHYW1lYm9hcmQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUGxheWVycygpIHtcclxuICBwbGF5ZXIgPSBwbGF5ZXJGYWN0b3J5KCk7XHJcbiAgbnBjID0gcGxheWVyRmFjdG9yeSh0cnVlKTtcclxuXHJcbiAgcGxheWVyLm9uUnVuKCk7XHJcbiAgbnBjLm9uUnVuKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUdhbWVib2FyZHMoKSB7XHJcbiAgY3JlYXRlR2FtZWJvYXJkKFwicGxheWVyXCIsIHBsYXllcik7XHJcbiAgY3JlYXRlR2FtZWJvYXJkKFwibnBjXCIsIG5wYyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBsYWNlU2hpcHMoKSB7XHJcbiAgbnBjR2FtZWJvYXJkLnBsYWNlU2hpcCgxLCA1LCBcIkNhcnJpZXJcIik7XHJcbiAgcGxhY2VTaGlwT25HYW1lYm9hcmQoXCJucGNcIiwgXCJDYXJyaWVyXCIsIDEsIDUpO1xyXG4gIG5wY0dhbWVib2FyZC5wbGFjZVNoaXAoMTAsIDUsIFwiQmF0dGxlc2hpcFwiKTtcclxuICBwbGFjZVNoaXBPbkdhbWVib2FyZChcIm5wY1wiLCBcIkJhdHRsZXNoaXBcIiwgMTAsIDUpO1xyXG4gIG5wY0dhbWVib2FyZC5wbGFjZVNoaXAoMTYsIDMsIFwiRGVzdHJveWVyXCIpO1xyXG4gIHBsYWNlU2hpcE9uR2FtZWJvYXJkKFwibnBjXCIsIFwiRGVzdHJveWVyXCIsIDE2LCAzKTtcclxuICBucGNHYW1lYm9hcmQucGxhY2VTaGlwKDI3LCAzLCBcIlN1Ym1hcmluZVwiKTtcclxuICBwbGFjZVNoaXBPbkdhbWVib2FyZChcIm5wY1wiLCBcIlN1Ym1hcmluZVwiLCAyNiwgMyk7XHJcbiAgbnBjR2FtZWJvYXJkLnBsYWNlU2hpcCg1MCwgMiwgXCJQYXRyb2xCb2F0XCIpO1xyXG4gIHBsYWNlU2hpcE9uR2FtZWJvYXJkKFwibnBjXCIsIFwiUGF0cm9sQm9hdFwiLCA1MCwgMik7XHJcblxyXG4gIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoMywgNSwgXCJDYXJyaWVyXCIpO1xyXG4gIHBsYWNlU2hpcE9uR2FtZWJvYXJkKFwicGxheWVyXCIsIFwiQ2FycmllclwiLCAzLCA1KTtcclxuICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDE1LCA1LCBcIkJhdHRsZXNoaXBcIik7XHJcbiAgcGxhY2VTaGlwT25HYW1lYm9hcmQoXCJwbGF5ZXJcIiwgXCJCYXR0bGVzaGlwXCIsIDE0LCA1KTtcclxuICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDI2LCAzLCBcIkRlc3Ryb3llclwiKTtcclxuICBwbGFjZVNoaXBPbkdhbWVib2FyZChcInBsYXllclwiLCBcIkRlc3Ryb3llclwiLCAyNSwgMyk7XHJcbiAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCg1MCwgMywgXCJTdWJtYXJpbmVcIik7XHJcbiAgcGxhY2VTaGlwT25HYW1lYm9hcmQoXCJwbGF5ZXJcIiwgXCJTdWJtYXJpbmVcIiwgNTAsIDMpO1xyXG4gIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoNzAsIDIsIFwiUGF0cm9sQm9hdFwiKTtcclxuICBwbGFjZVNoaXBPbkdhbWVib2FyZChcInBsYXllclwiLCBcIlBhdHJvbEJvYXRcIiwgNzAsIDIpO1xyXG59XHJcblxyXG5leHBvcnQgeyBpbml0aWFsaXplLCBnZXRQbGF5ZXIgfTtcclxuIl0sIm5hbWVzIjpbInNoaXAiLCJtb2R1bGUiLCJleHBvcnRzIiwiZmlyc3RSdW4iLCJnYW1lYm9hcmRBcnJheSIsImNhcnJpZXIiLCJiYXR0bGVzaGlwIiwiZGVzdHJveWVyIiwic3VibWFyaW5lIiwicGF0cm9sQm9hdCIsImdldFNoaXAiLCJzaGlwTmFtZSIsIm9uU3RhcnQiLCJjZWxscyIsImkiLCJwdXNoIiwicGxhY2VTaGlwIiwiY2VsbCIsImxlbmd0aCIsIl9hZGRTaGlwVG9BcnJheSIsInJlY2VpdmVBdHRhY2siLCJjb29yZGluYXRlIiwic2hpcENvb3JkaW5hdGUiLCJyZXN1bHQiLCJpbkFycmF5IiwiY29uc29sZSIsImxvZyIsInNoaXBzIiwic3BsaXQiLCJzaGlwT2JqZWN0IiwiaXNTdW5rIiwiaGl0IiwiZ2V0QXJyYXkiLCJhbGxTdW5rIiwiYXJyYXkiLCJnZXRHYW1lYm9hcmRTaXplIiwiZ2V0R2FtZWJvYXJkQXJyYXkiLCJnYW1lYm9hcmQiLCJucGMiLCJ0dXJuIiwicGxheWVyR2FtZWJvYXJkIiwidW5kZWZpbmVkIiwic2V0VHVybiIsImJvb2xlYW4iLCJnZXRSYW5kb21Db29yZGluYXRlIiwib3Bwb25lbnRHYW1lYm9hcmQiLCJyYW5kb21Db29yZGluYXRlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwib25SdW4iLCJhdHRhY2siLCJucGNPYmplY3QiLCJnZXRHYW1lYm9hcmQiLCJyZWFsSGl0IiwibiIsImNyZWF0ZUFycmF5IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsInBsYXllck9iamVjdCIsInBsYXllclNpbmsiLCJucGNTaW5rIiwicGxheWVyVGltZW91dCIsImNoYW5nZURpc3BsYXlUZXh0Iiwic3RyaW5nIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJjcmVhdGVHYW1lYm9hcmQiLCJwbGF5ZXJOYW1lIiwib2JqZWN0IiwibWFpbkNvbnRhaW5lciIsImNvbnRhaW5lciIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJkYXRhc2V0IiwiY2VsbElkIiwiYXBwZW5kIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0ZXh0IiwiZTIiLCJwYXRoIiwidGFyZ2V0IiwiZ2V0QXR0cmlidXRlIiwibWVzc2FnZSIsImRvbUF0dGFjayIsInNldFRpbWVvdXQiLCJwbGF5ZXIiLCJlMSIsInBsYWNlU2hpcE9uR2FtZWJvYXJkIiwic3RhcnRQb2ludCIsInJ1biIsIngiLCJjaGlsZHJlbiIsImoiLCJzaGlwU29tZXRoaW5nIiwic2hpcENlbGwiLCJwbGF5ZXJGYWN0b3J5IiwibnBjR2FtZWJvYXJkIiwiZ2V0UGxheWVyIl0sInNvdXJjZVJvb3QiOiIifQ==